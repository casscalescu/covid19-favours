<h1>Dashboard</h1>

<!-- Review notification -->
<div class="container">
  <% if current_user.helper? %>
    <% @helper_done_favours.each do |favour| %>
      <% unless favour.reviews.where(subject: "Helper").exists? %>
        <div class="card">
          <p>Favour: <%= favour.title %></p>
          <p>You completed a favour for: <%= link_to favour.recipient.first_name, user_path(favour.recipient) %></p>
          <%= link_to "Review", new_favour_review_path(favour), class: "btn btn-primary" %>
        </div>
      <% end %>
    <% end %>
  <% end %>
  <% if current_user.recipient? %>
    <% @recipient_done_favours.each do |favour| %>
      <% unless favour.reviews.where(subject: "Recipient").exists? %>
        <div class="card">
          <p>Favour: <%= favour.title %></p>
          <p>Completed by: <%= link_to favour.helper.first_name, user_path(favour.helper) %></p>
          <%= link_to "Review", new_favour_review_path(favour), class: "btn btn-primary" %>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>


<div class="container">
  <% if current_user.helper? %>
    <div class="helper-favours">
      <div class="accepted-favours">
        <h4>Accepted Favours</h4>
        <% @helper_accepted.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <p><%= favour.recipient.first_name %></p>
            <p><%= favour.recipient.mobile %></p>
          </div>
        <% end %>
      </div>
      <div class="open-favours">
        <h4>Applied Favours</h4>
        <% @helper_open.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <p><%= favour.recipient.first_name %></p>
          </div>
        <% end %>
      </div>
      <div class="archived-favours">
        <h4>Archived Favours</h4>
        <% @helper_archived.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <p><%= favour.recipient.first_name %></p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
  <% if current_user.recipient? %>
    <div class="recipient-favours">
      <div class="accepted-favours">
        <h4>Accepted Favours</h4>
        <% @recipient_accepted.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <p><%= favour.helper.first_name %></p>
            <p><%= favour.helper.mobile %></p>
          </div>
        <% end %>
      </div>
      <div class="open-favours">
        <h4>Open Favours</h4>
        <% @recipient_accepted.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <h6>Applicants:</h6>
            <ul>
            <% favour.applicants.each do |applicant| %>
              <li>applicant.first_name</li>
            <% end %>
            </ul>
          </div>
        <% end %>
      </div>
      <div class="archived-favours">
        <h4>Archived Favours</h4>
        <% @recipient_archived.each do |favour| %>
          <div class="card">
            <%= link_to "#{favour.title}", favour_path(favour) %>
            <p><%= favour.description %></p>
            <p><%= favour.address %></p>
            <p><%= favour.helper.first_name %></p>
            <p><%= favour.helper.mobile %></p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
